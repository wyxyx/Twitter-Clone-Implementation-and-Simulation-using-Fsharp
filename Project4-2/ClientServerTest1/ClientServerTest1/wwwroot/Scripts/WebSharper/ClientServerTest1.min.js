(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;a=self;b=a.ClientServerTest1=a.ClientServerTest1||{};c=b.WebSocketServer=b.WebSocketServer||{};d=c.S2CMessage=c.S2CMessage||{};e=b.WebSocketClient=b.WebSocketClient||{};f=b.Website=b.Website||{};g=f.Client=f.Client||{};h=a.ClientServerTest1_Templates=a.ClientServerTest1_Templates||{};i=a.ClientServerTest1_JsonEncoder=a.ClientServerTest1_JsonEncoder||{};j=a.ClientServerTest1_JsonDecoder=a.ClientServerTest1_JsonDecoder||{};k=a.WebSharper;l=k&&k.UI;m=l&&l.Var$1;n=l&&l.Submitter;o=l&&l.View;p=k&&k.Remoting;q=p&&p.AjaxRemotingProvider;r=k&&k.Arrays;s=k&&k.Concurrency;t=l&&l.Doc;u=k&&k.AspNetCore;v=u&&u.WebSocket;w=v&&v.Client;x=w&&w.WithEncoding;y=a.JSON;z=k&&k.Utils;A=a.IntelliFactory;B=A&&A.Runtime;C=l&&l.AttrProxy;D=l&&l.Templating;E=D&&D.Runtime;F=E&&E.Server;G=F&&F.ProviderBuilder;H=F&&F.Handler;I=F&&F.TemplateInstance;J=l&&l.Client;K=J&&J.Templates;L=k&&k.ClientSideJson;M=L&&L.Provider;d.LogInFailed={$:3};e.WebSocketTest=function(N){var O,P,Q,R,S,T,U,V,W,X;function Y(Z){return Z(function(_0){var _1;_1=self.document.createTextNode(_0+"\n");W.elt.appendChild(_1);});}O="";P=0;Q="";R="";S="";T=m.Create$1("");U=n.CreateOption(T.get_View());V=o.MapAsync(function(Z){var _0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_;return Z!=null&&Z.$==1?(_0=Z.$0,(_1=(new q.New()).Sync("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.SplitByComma:1982470384",[_0]),r.get(_1,0)==="register"?r.length(_1)===3?(P=1,O=r.get(_1,0),Q=r.get(_1,1),R=r.get(_1,2),_2=null,s.Delay(function(){return s.Return("");})):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])):r.get(_1,0)==="login"?r.length(_1)===3?S===""?(P=1,O=r.get(_1,0),S=r.get(_1,1),Q=r.get(_1,1),R=r.get(_1,2),_3=null,s.Delay(function(){return s.Return("");})):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.DuplicateLogin:-1146015191",[_0])):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])):r.get(_1,0)==="logout"?r.length(_1)===1?(P=1,O=r.get(_1,0),S!==""?(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowLogOut:-1146015191",[S]):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowWrongOrder:-1146015191",[_0]))):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])):r.get(_1,0)==="subscribe"?r.length(_1)===2?(P=1,O=r.get(_1,0),Q=r.get(_1,1),S===""?(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowWrongOrder:-1146015191",[_0])):S===Q?(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.SubYourself:-1146015191",[_0])):(_4=null,s.Delay(function(){return s.Return("");}))):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])):r.get(_1,0)==="send"?r.length(_1)===2?(P=1,O=r.get(_1,0),Q=r.get(_1,1),S===""?(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowWrongOrder:-1146015191",[_0])):(_5=null,s.Delay(function(){return s.Return("");}))):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])):r.get(_1,0)==="retweet"?r.length(_1)===2?(P=1,O=r.get(_1,0),Q=r.get(_1,1),S===""?(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowWrongOrder:-1146015191",[_0])):(_6=null,s.Delay(function(){return s.Return("");}))):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])):r.get(_1,0)==="query"?r.length(_1)===3?r.get(_1,1)==="tag"?(P=1,O=r.get(_1,0),Q=r.get(_1,1),R=r.get(_1,2),S===""?(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowWrongOrder:-1146015191",[_0])):(_7=null,s.Delay(function(){return s.Return("");}))):r.get(_1,1)==="mentioned"?(P=1,O=r.get(_1,0),Q=r.get(_1,1),R=r.get(_1,2),S===""?(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowWrongOrder:-1146015191",[_0])):(_8=null,s.Delay(function(){return s.Return("");}))):r.get(_1,1)==="username"?(P=1,O=r.get(_1,0),Q=r.get(_1,1),R=r.get(_1,2),S===""?(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowWrongOrder:-1146015191",[_0])):(_9=null,s.Delay(function(){return s.Return("");}))):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])):(P=0,(new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketServer.ShowError:-1146015191",[_0])))):(P=0,_=null,s.Delay(function(){return s.Return("");}));},U.view);W=t.Element("pre",[],[]);s.Start((X=null,s.Delay(function(){return s.Bind(x.ConnectStateful(function(Z){return y.stringify((i.j())(Z));},function(Z){return(j.j())(y.parse(Z));},N,function(){var Z;Z=null;return s.Delay(function(){return s.Return([0,function(_0){return function(_1){var _2;_2=null;return s.Delay(function(){var _3,_4,_5,_6,_7,_8,_9,_,$,ba;return _1.$==3?(Y(function(bb){return bb("WebSocket connection closed.");}),s.Return(_0)):_1.$==2?(Y(function(bb){return bb("WebSocket connection open.");}),s.Return(_0)):_1.$==1?(Y(function(bb){return bb("WebSocket connection error!");}),s.Return(_0)):(_3=_1.$0,s.Combine(_3.$==1?((Y(function(bb){return function(bc){return bb("Registed failed, "+z.toSafe(bc)+" has already been registed!");};}))(_3.$0),s.Zero()):_3.$==2?(_4=_3.$0,((Y(function(bb){return function(bc){return bb(z.toSafe(bc)+" logged in.");};}))(_4),(Y(function(bb){return function(bc){return bb("Welcome, "+z.toSafe(bc)+"!");};}))(_4),(Y(function(bb){return function(bc){return bb("----Current User: "+z.toSafe(bc)+"----");};}))(_4),s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.LogInSuccess:1131399653",[_4]),function(){return s.Return(null);}))):_3.$==3?(S="",Y(function(bb){return bb("Invalid username or password!");}),s.Zero()):_3.$==4?(_5=_3.$0,((Y(function(bb){return function(bc){return bb(z.toSafe(bc)+" logged out.");};}))(_5),s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.LogOutSuccess:1131399653",[_5]),function(){return s.Return(null);}))):_3.$==5?(_6=_3.$0,(_7=_3.$1,(((Y(B.Curried3(function(bb,bc,bd){return bb(z.toSafe(bc)+" subscribes "+z.toSafe(bd)+" successfully.");})))(_6))(_7),s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.Subscribing:-685279371",[_6,_7]),function(){return s.Return(null);})))):_3.$==6?(_8=_3.$1,((((Y(B.Curried(function(bb,bc,bd,be){return bb(z.toSafe(bc)+" does not exist or "+z.toSafe(bd)+" has already subscribed to "+z.toSafe(be)+".");},4)))(_8))(_3.$0))(_8),s.Zero())):_3.$==7?s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.BeSubscribed:-685279371",[_3.$0,_3.$1]),function(){return s.Return(null);}):_3.$==8?(_9=_3.$0,(_=_3.$1,s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.ResponseSendTweet:-47597098",[_9,_,_3.$2]),function(){((Y(B.Curried3(function(bb,bc,bd){return bb(z.toSafe(bc)+" sends a tweet: "+z.toSafe(bd));})))(_9))(_);return s.Zero();}))):_3.$==9?($=_3.$0,s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.ResponseReTweet:-685279371",[$,_3.$1]),function(){(Y(function(bb){return function(bc){return bb(z.toSafe(bc)+" retweets successfully.");};}))($);return s.Zero();})):_3.$==10?s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.QueryByTag:-685279371",[_3.$0,_3.$1]),function(){Y(function(bb){return bb("Query By Tag, please check console for details.");});return s.Zero();}):_3.$==11?s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.QueryByMentioned:-685279371",[_3.$0,_3.$1]),function(){Y(function(bb){return bb("Query By Mentioned, please check console for details.");});return s.Zero();}):_3.$==12?s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.QueryByUsername:-685279371",[_3.$0,_3.$1]),function(){Y(function(bb){return bb("Query By Username, please check console for details.");});return s.Zero();}):(ba=_3.$0,((Y(function(bb){return function(bc){return bb(z.toSafe(bc)+" registed successfully, password: *** ");};}))(ba),s.Bind((new q.New()).Async("ClientServerTest1:ClientServerTest1.WebSocketClient+ActorModule.RegisterSuccess:-685279371",[ba,_3.$1]),function(){return s.Return(null);}))),s.Delay(function(){return s.Return(_0+1);})));});};}]);});}),function(Z){return s.While(function(){return true;},s.Delay(function(){return P===1?(P=0,O==="register"?s.Bind(s.Sleep(500),function(){Z.Post({$:0,$0:Q,$1:R});return s.Zero();}):O==="login"?s.Bind(s.Sleep(500),function(){Z.Post({$:1,$0:Q,$1:R});return s.Zero();}):O==="logout"?s.Bind(s.Sleep(500),function(){Z.Post({$:2,$0:S});S="";return s.Zero();}):O==="subscribe"?s.Bind(s.Sleep(500),function(){Z.Post({$:3,$0:S,$1:Q});return s.Zero();}):O==="send"?s.Bind(s.Sleep(500),function(){Z.Post({$:4,$0:S,$1:Q});return s.Zero();}):O==="retweet"?s.Bind(s.Sleep(500),function(){Z.Post({$:5,$0:S,$1:Q});return s.Zero();}):O==="query"?Q==="tag"?s.Bind(s.Sleep(500),function(){Z.Post({$:6,$0:S,$1:R});return s.Zero();}):Q==="mentioned"?s.Bind(s.Sleep(500),function(){Z.Post({$:7,$0:S,$1:R});return s.Zero();}):Q==="username"?s.Bind(s.Sleep(500),function(){Z.Post({$:8,$0:S,$1:R});return s.Zero();}):s.Zero():s.Zero()):P===0?s.Bind(s.Sleep(500),function(){return s.Return(null);}):s.Zero();}));});})),null);return t.Element("div",[],[t.Input([],T),t.Button("Send",[],function(){U.Trigger();}),t.Element("hr",[],[]),t.Element("h4",[C.Create("class","text-muted")],[t.TextNode("The server responded:")]),t.Element("div",[C.Create("class","jumbotron")],[t.Element("h4",[],[t.TextView(V)])]),W]);};g.Main=function(N,O){var P,Q,R,S,T;return(P=(Q=e.WebSocketTest(O),(R=new G.New$1(),(R.h.push({$:0,$0:"websockettest",$1:Q}),R))),(S=H.CompleteHoles(P.k,P.h,[]),(T=new I.New(S[1],h.body(S[0])),P.i=T,T))).get_Doc();};h.body=function(N){K.LoadLocalTemplates("main");return N?K.NamedTemplate("main",{$:1,$0:"body"},N):void 0;};i.j=function(){return i._v?i._v:i._v=(M.EncodeUnion(void 0,{queriedusername:8,mentioned:7,tag:6,tweetcontent5:5,tweetcontent4:4,subscribeto3:3,username2:2,psw1:1,psw0:0},[["RequestRegister",[["$0","username0",M.Id(),0],["$1","psw0",M.Id(),0]]],["RequestLogIn",[["$0","username1",M.Id(),0],["$1","psw1",M.Id(),0]]],["RequestLogOut",[["$0","username2",M.Id(),0]]],["WantSubscribe",[["$0","username3",M.Id(),0],["$1","subscribeto3",M.Id(),0]]],["WantSendTweet",[["$0","username4",M.Id(),0],["$1","tweetcontent4",M.Id(),0]]],["WantReTweet",[["$0","username5",M.Id(),0],["$1","tweetcontent5",M.Id(),0]]],["WantQueryByTag",[["$0","username6",M.Id(),0],["$1","tag",M.Id(),0]]],["WantQueryByMentioned",[["$0","username7",M.Id(),0],["$1","mentioned",M.Id(),0]]],["WantQueryByUsername",[["$0","username8",M.Id(),0],["$1","queriedusername",M.Id(),0]]]]))();};j.j=function(){return j._v?j._v:j._v=(M.DecodeUnion(void 0,"type",[["RegisterSuccess",[["$0","username9",M.Id(),0],["$1","psw9",M.Id(),0]]],["RegisterFailed",[["$0","username19",M.Id(),0]]],["LogInSuccess",[["$0","username10",M.Id(),0],["$1","psw10",M.Id(),0]]],["LogInFailed",[]],["LogOutSuccess",[["$0","username11",M.Id(),0]]],["Subscribing",[["$0","username12",M.Id(),0],["$1","subscribeto12",M.Id(),0]]],["SubscribeFailed",[["$0","username20",M.Id(),0],["$1","subscribeto20",M.Id(),0]]],["BeSubscribed",[["$0","subscribeto13",M.Id(),0],["$1","username13",M.Id(),0]]],["ResponseSendTweet",[["$0","username14",M.Id(),0],["$1","tweetcontent14",M.Id(),0],["$2","followers14",M.DecodeList(M.Id()),0]]],["ResponseReTweet",[["$0","username15",M.Id(),0],["$1","tweetcontent15",M.Id(),0]]],["QueryByTag",[["$0","username16",M.Id(),0],["$1","tag16",M.Id(),0]]],["QueryByMentioned",[["$0","username17",M.Id(),0],["$1","mentioned17",M.Id(),0]]],["QueryByUsername",[["$0","username18",M.Id(),0],["$1","queriedusername18",M.Id(),0]]]]))();};}());
